---
import { getCollection } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";

const posts = await getCollection("posts");
const categoryCounts = new Map<string, number>();

posts.forEach((post) => {
  (post.data.categories || []).forEach((category) => {
    categoryCounts.set(category, (categoryCounts.get(category) || 0) + 1);
  });
});

const sortedCategories = [...categoryCounts.entries()].sort((a, b) => b[1] - a[1]);
---

<BaseLayout
  title="Categories"
  description="All categories from K-PAI posts"
>
  <div class="max-w-4xl mx-auto">
    <h1 class="text-4xl font-bold mb-8">Categories</h1>

    {
      sortedCategories.length > 0 ? (
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          {sortedCategories.map(([category, count]) => (
            <a
              href={`/categories/${category}/`}
              class="block p-4 bg-white border rounded-lg hover:shadow-md transition-shadow"
            >
              <h2 class="text-xl font-semibold mb-1">{category}</h2>
              <p class="text-sm text-gray-600">
                {count} post{count !== 1 ? "s" : ""}
              </p>
            </a>
          ))}
        </div>
      ) : (
        <p class="text-gray-600">No categories found.</p>
      )
    }
  </div>
</BaseLayout>
